---
title: "CML_EDA_clean"
author: "Catherine Lucey"
date: "12/9/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This document is a cleaner, easier to understand and use version of the CML_EDA_viz.rmd file, which is moreso a collection of notes and ideas. This is the code I will use to generate the actual figures for the report/website.

### setup code

```{r}
library(tidyverse)
library(plotly)
library(patchwork)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

### Loading in Data

```{r}

shsat_covid_df = 
  read_csv("project_df.csv") %>%
  mutate(
    year = factor(year, levels = c("2015", "2016", "2017", "2018", "2019", "2020"))
  ) %>% 
  select(zip, modzcta, borough, 
         dbn, year, n_hs_applicants, n_testers, n_offers, 
         modzcta_cum_perc_pos, cum_ave_death_rate
         )

```

### fig 1

```{r}

offer_per_tester_gg =
  shsat_covid_df %>%
  filter(n_offers > 5) %>% 
  mutate(
    offers_per_testers = n_offers / n_testers
  ) %>% 
  group_by(year) %>% 
  ggplot(aes(x = year, y = offers_per_testers)) +
  geom_boxplot() +
  facet_grid(. ~borough) +
  theme(axis.text.x = element_text(angle = 90))

```

Does the association change when the denominator is all hs applicants and not jsut the specialized high school applicants?

```{r}

offer_per_applicants_gg =
  shsat_df %>%
  filter(n_offers > 5) %>% 
  mutate(
    offers_per_applicants = n_offers / n_hs_applicants
  ) %>% 
  group_by(year) %>% 
  ggplot(aes(x = year, y = offers_per_applicants)) +
  geom_boxplot() +
  facet_grid(. ~borough) +
  theme(axis.text.x = element_text(angle = 90))

offer_per_tester_gg / offer_per_applicants_gg

```

Did the proportion of hs applicants applying to specialized high schools change over time?

```{r}

testers_per_applicants_gg =
  shsat_df %>%
  filter(n_offers > 5) %>% 
  mutate(
    testers_per_applicants = n_testers / n_hs_applicants
  ) %>% 
  group_by(year) %>% 
  ggplot(aes(x = year, y = testers_per_applicants)) +
  geom_boxplot() +
  facet_grid(. ~borough) +
  theme(axis.text.x = element_text(angle = 90))


```


### Plotting modzcta average offers weighted by n_testers and proportion of offers to testers across 6 years by borough

Generate the apropriate data frame:



```{r}

zcta_wt_avgs_df =
  read_csv("project_df.csv") %>%
  select(modzcta, dbn, n_hs_applicants, n_testers, n_offers, year, modzcta_cum_perc_pos, cum_ave_death_rate) %>%
  filter(n_offers > 5) %>% 
  drop_na() %>% 
  group_by(modzcta, year) %>% 
  summarize(
    avg_testers = mean(n_testers),
    avg_offers = mean(n_offers),
    avg_applicants = mean(n_hs_applicants),
    wt_avg_offers = weighted.mean(n_offers, n_testers)
  )
  

```


```{r}

zip_avg_shsat_df =
  read_csv("filtered_weighted_avgs")

```

