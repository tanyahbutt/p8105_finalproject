<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="By: Tanya Butt, Catherine Lucey, and Irene Martinez Morata" />

<meta name="date" content="2021-12-11" />

<title>P8105 Final Project Report</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="analysis.html">Exploratory Analysis</a>
</li>
<li>
  <a href="nyc_maps.html">Map Visualizations</a>
</li>
<li>
  <a href="Final_Project_Report.html">Project Report</a>
</li>
<li>
  <a href="mailto:&lt;thb2114@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/tanyahbutt/p8105_finalproject">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">P8105 Final Project Report</h1>
<h4 class="author">By: Tanya Butt, Catherine Lucey, and Irene Martinez Morata</h4>
<h4 class="date">12/11/2021</h4>

</div>


<div id="covid-19-and-specialized-high-school-admissons-in-new-york-city" class="section level1">
<h1>Covid-19 And Specialized High School Admissons in New York City</h1>
<p>Exploring the Potential Associations between Specialized High School Admissions Offers and COVID-19 Rates in NYC</p>
<div id="motivation-and-related-work" class="section level2">
<h2>Motivation and Related Work</h2>
</div>
<div id="project-aims" class="section level2">
<h2>Project Aims</h2>
<ol style="list-style-type: decimal">
<li>Identify and evaluate the Covid-19 positive rate incidence, death rate, high school applications and SH SAT testers and offers in New York City during 2020 and the previous 4 years.</li>
<li>Compare the time-trends of SH SAT test takers and from 2015 to 2020</li>
<li>Visualize the geographical distribution of Covid-19 incidence, death rate and proportion of SG SAT offers during 2020 across MOZCTA</li>
<li>Assess the association between Covid-19 positive rate cumulative incidence and the number of students that got an SH SAT offer in 2020 by MOZCTA in New York City.</li>
<li>Assess the association between Covid-19 death rate by 100,000 inhabitants and the number of students that got an SH SAT offer in 2020 by MOZCTA in New York City.</li>
</ol>
</div>
<div id="data-cleaning" class="section level2">
<h2>Data Cleaning</h2>
<div id="shsat-testing-and-offers-dataset" class="section level3">
<h3>SHSAT Testing and Offers Dataset</h3>
<div id="loading-and-cleaning-yearly-shsat-data" class="section level5">
<h5>Loading and Cleaning Yearly SHSAT Data</h5>
<p>Due to small differences in variable naming between 2015-2017 and 2018-2020, data importing and cleaning was done in two parts using the functions <code>clean_shsatv1</code> and <code>clean_shsatv2</code>. In the original data sets, the number of offers for schools where five or fewer students received an offer to a specialized high school was recorded as “0-5,” thus we could not distinguish between schools that had no students receiving a specialized high school offer and schools that had up to five students receiving an offer. 0-5 values for <code>n_offers</code> were converted to “5,” and all values in the column were converted to numerics for easy manipulation. School years, of the format 2015-2016, were re-coded as the year of the fall semester: <code>year = 2015</code> represents school year that began in Fall 2015 and ended in Spring 2016, in which eighth graders took the SHSAT in the fall of 2015 and received high school offers in the spring of 2016. Lastly, duplicates were removed from the combined SHSAT dataset with the <code>unique()</code> function, removing 565 values. We suspect that all duplicates are from the 2019 dataset, which seems to mysteriously duplicate in the <code>rbind()</code> process.</p>
<pre class="r"><code># define functions to load and clean each .csv

clean_shsatv1 = function(df){
  clean_df = 
    df %&gt;% 
    janitor::clean_names() %&gt;% 
    rename(
      dbn = feeder_school_dbn,
      feeder_school = feeder_school_name,
      n_offers = count_of_offers,
      n_testers = count_of_testers,
      n_hs_applicants = count_of_students_in_hs_admissions,
      ) %&gt;% 
    mutate(
      n_hs_applicants = 
        replace(n_hs_applicants, n_hs_applicants == &quot;0-5&quot;, &quot;5&quot;),
      n_hs_applicants = as.double(n_hs_applicants)
    ) %&gt;% 
    mutate(
      n_offers = 
        replace(n_offers, n_offers == &quot;0-5&quot;, &quot;5&quot;),
      n_offers = as.double(n_offers)
    ) %&gt;% 
    mutate(
      n_testers =
        replace(n_testers, n_testers == &quot;0-5&quot;, &quot;5&quot;),
      n_testers = as.double(n_testers)
    )
  
  return(clean_df)
}

clean_shsatv2 = function(df){
  clean_df =
    df %&gt;% 
    janitor::clean_names() %&gt;% 
    rename(
      dbn = feeder_school_dbn,
      feeder_school = feeder_school_name,
      n_offers = number_of_offers,
      n_testers = count_of_testers,
      n_hs_applicants = count_of_students_in_hs_admissions,
      ) %&gt;% 
    mutate(
      n_hs_applicants = 
        replace(n_hs_applicants, n_hs_applicants == &quot;0-5&quot;, &quot;5&quot;),
      n_hs_applicants = as.double(n_hs_applicants)
    ) %&gt;% 
    mutate(
      n_offers = 
        replace(n_offers, n_offers == &quot;0-5&quot;, &quot;5&quot;),
      n_offers = as.double(n_offers)
    ) %&gt;% 
    mutate(
      n_testers =
        replace(n_testers, n_testers == &quot;0-5&quot;, &quot;5&quot;),
      n_testers = as.double(n_testers)
    )
  
  return(clean_df)
}</code></pre>
<pre class="r"><code># import and clean each of the six years of SHSAT data individually

fifteen_df = 
  read_csv(&quot;raw_data/shsat_1/2015-2016_SHSAT_Admissions_Test_Offers_By_Sending_School.csv&quot;) %&gt;% 
  mutate(year = &quot;2015&quot;) %&gt;% 
  clean_shsatv1()

sixteen_df =
  read_csv(&quot;raw_data/shsat_1/2016-2017_SHSAT_Admissions_Test_Offers_By_Sending_School.csv&quot;) %&gt;% 
  mutate(year = &quot;2016&quot;) %&gt;% 
  clean_shsatv1()

seventeen_df =
  read_csv(&quot;raw_data/shsat_1/2017-2018_SHSAT_Admissions_Test_Offers_By_Sending_School.csv&quot;) %&gt;% 
  mutate(year = &quot;2017&quot;) %&gt;% 
  clean_shsatv1()

eighteen_df =
  read_csv(&quot;raw_data/shsat_1/2018-2019_SHSAT_Admissions_Test_Offers_By_Sending_School.csv&quot;) %&gt;% 
  mutate(year = &quot;2018&quot;) %&gt;% 
  clean_shsatv2()

nineteen_df =
  read_csv(&quot;raw_data/shsat_1/2019-2020_SHSAT_Admissions_Test_Offers_By_Sending_School.csv&quot;) %&gt;% 
  mutate(year = &quot;2019&quot;) %&gt;% 
  clean_shsatv2()

twenty_df =
  read_csv(&quot;raw_data/shsat_1/2020-2021_SHSAT_Admissions_Test_Offers_By_Sending_School.csv&quot;) %&gt;% 
  mutate(year = &quot;2020&quot;) %&gt;% 
  clean_shsatv2()

# bind all years into a cohesive dataframe, filter for unique values

shsat_df = 
  rbind(
    fifteen_df, 
    sixteen_df, 
    seventeen_df, 
    eighteen_df, 
    nineteen_df, 
    twenty_df) %&gt;% 
  unique()</code></pre>
<p>These data were then joined with the DOE 2020 Middle School Directory dataset to obtain a zip code for each sending middle school, and exported for use in subsequent analyses.</p>
<pre class="r"><code>ms_dir_import =
  read_csv(&quot;raw_data/2019_DOE_Middle_School_Directory.csv&quot;) %&gt;% 
  janitor::clean_names() %&gt;% 
  select(schooldbn, borough, postcode, address) %&gt;% 
  rename(
    dbn = schooldbn,
    zip = postcode
  )

shsat_zip_df =
  full_join(shsat_df, ms_dir_import, by = &quot;dbn&quot;) %&gt;% 
  select(dbn, n_hs_applicants, n_testers, n_offers, year, borough, zip) %&gt;% 
  drop_na()

# write.csv(shsat_zip_df, &quot;shsat_data.csv&quot;)</code></pre>
<p>Because the DOE middle school directory only includes data for public middle schools, addresses were not available for charter schools and thus charter schools were excluded from this analysis (max of n = 191 in 2020), leaving data for 464 schools for 2015-2017, 465 schools for 2018 and 2019, and 467 schools in 2020 (See TABLE WHAT NUMBER???).</p>
<pre class="r"><code># keep a version of the shsat_zip_df that retains NA values just to count NAs

full_shsat_zip_df =
  full_join(shsat_df, ms_dir_import, by = &quot;dbn&quot;)

n_kept =
  full_shsat_zip_df %&gt;%
  select(zip, year) %&gt;% 
  filter(!is.na(zip)) %&gt;% 
  group_by(year) %&gt;%
  count()

n_na =
  full_shsat_zip_df %&gt;%
  select(zip, year) %&gt;% 
  filter(is.na(zip)) %&gt;% 
  group_by(year) %&gt;%
  count()

n_removed_table =
  full_join(n_na, n_kept, by = &quot;year&quot;) %&gt;% 
  mutate(
    `Number of NA Values Removed` = n.x,
    `Number of Schools Kept` = n.y
  ) %&gt;% 
  select(year,`Number of NA Values Removed`, `Number of Schools Kept` ) %&gt;% 
  knitr::kable() %&gt;% 
  print()</code></pre>
<pre><code>## 
## 
## |year | Number of NA Values Removed| Number of Schools Kept|
## |:----|---------------------------:|----------------------:|
## |2015 |                         130|                    464|
## |2016 |                         130|                    464|
## |2017 |                         130|                    464|
## |2018 |                         120|                    465|
## |2019 |                         130|                    465|
## |2020 |                         191|                    467|</code></pre>
<p>Lastly, we calculated the weighted average of offers for all years, 2015-2019, and 2020 by using the <code>weighted.mean()</code> function, weighting the number of offers at a school by the number of students applying to specialized high schools, and averaging across all schools within a ZCTA. All weighted averages were calculated after filtering to select only schools with &gt; 5 offers total. Furthermore, <code>n_offers</code> and <code>n_testers</code> were similarly averaged within a ZCTA and for all years, 2015-2019, and 2020 alone.</p>
<pre class="r"><code>filtered_wt_avgs_df =
  read_csv(&quot;raw_data/project_df.csv&quot;) %&gt;%
  select(modzcta, dbn, n_testers, n_offers, year) %&gt;%
  drop_na() %&gt;% 
  filter(n_offers &gt; 5) %&gt;% 
  group_by(modzcta, year) %&gt;% 
  summarize(
    avg_testers = mean(n_testers),
    avg_offers = mean(n_offers),
    wt_avg = weighted.mean(n_offers, n_testers)
  ) %&gt;% 
  pivot_wider(names_from = year, values_from = avg_testers:wt_avg) %&gt;%
  drop_na() %&gt;% 
  mutate(
    `2015-19_avg_testers` = mean(avg_testers_2015:avg_testers_2019),
    `2015-19_avg_offers` = mean(avg_offers_2015:avg_testers_2019),
    `2015-19_wt_avg` = mean(wt_avg_2015:wt_avg_2019),
    all_years_avg_testers = mean(avg_testers_2015:avg_testers_2020),
    all_years_avg_offers = mean(avg_offers_2015:avg_testers_2020),
    all_years_wt_avg = mean(wt_avg_2015:wt_avg_2020)
  ) %&gt;% 
  select(
    all_years_avg_testers, 
    all_years_avg_offers, 
    all_years_wt_avg, 
    `2015-19_avg_testers`,
    `2015-19_avg_offers`, 
    `2015-19_wt_avg`, 
    avg_testers_2020, 
    avg_offers_2020, 
    wt_avg_2020
    )

# write.csv(wt_avgs_df, &quot;filtered_weighted_avgs.csv&quot;)</code></pre>
</div>
</div>
<div id="variable-dictionary" class="section level3">
<h3>Variable Dictionary</h3>
<p><code>n_offers</code> = total number of eighth grade students who received an offer to a specialized high school at a given middle school</p>
<p><code>n_testers</code> = total number of eighth grade students taking the SHSAT exam, equivalent to the number of students applying to specialized high schools at a given middle school</p>
<p><code>n_hs_applicants</code> = total number of eighth grade students participating in the high school applications process (applicants to specialized + non-specialized high schools) at a given middle school</p>
<p><code>dbn</code> = district borough number, a unique school identification number assigned by the NYC DOE</p>
<p><code>feeder_school</code> = full name of the “sending” middle school (middle school at which applicants are currently enrolled)</p>
</div>
<div id="covid-19-cumulative-incidence-rate-in-2020" class="section level3">
<h3>Covid-19 cumulative incidence rate in 2020</h3>
<p>The Covid-19 cumulative incidence rate in 2020 was imported directly from the github repository of the <a href="https://github.com/nychealth/coronavirus-data">NYC Department of Health and Mental Hygiene</a> This data set contains the cumulative Covid-19 positive incidence rate from March 2020 until December 2020. In this data set, a person is classified as a confirmed COVID-19 case if they test positive with a molecular test.This data set include people who live in NYC. Any person with a residence outside of NYC is not included. Children attending school and their families should be residents in NYC to do so, thus, this is a potential benefit of using this data set, which is excluding the “noise” from external individuals testing positive for Covid-19 in a neighborhood but not residing there.</p>
</div>
<div id="variable-dictionary-1" class="section level3">
<h3>Variable Dictionary</h3>
<p><code>modzcta_cum_perc_pos</code> = cumulative incidence of confirmed Covid-19 positive cases from March 2020 until December 2020 in NYC.</p>
<pre class="r"><code>test2 &lt;- read_csv(&quot;raw_data/tests-by-zcta.csv&quot;)</code></pre>
</div>
</div>
<div id="modzcta-level-shapefile" class="section level2">
<h2>MODZCTA level shapefile</h2>
<p>To obtain consistent area units across the datasets, we used a <a href="https://github.com/nychealth/coronavirus-data/blob/master/Geography-resources/ZCTA-to-MODZCTA.csv">crosswalk file</a> to convert zip-codes to MODZCTAs. MODZCTAs, based on the 2010 U.S. Census, arecurrently used by the NYC DOHMH for the mapping of COVID-19. The use of MODZCTA as out spatial level allow us to overcome several limitations of the zip code level data (i.e., A ZIP Code doesn’t actually refer to an area, but rather a collection of points that make up a mail delivery route). The modified ZCTA (MODZCTA) geography combines census blocks with smaller populations to allow more stable estimates of population size for rate calculation. Information by geography reflect people’s MODZCTA of residence at the time of reporting, and not the location of testing, diagnosing, or hospitalization. The ZCTA geography was developed by the U.S. Census Bureau.</p>
</div>
<div id="data-join" class="section level2">
<h2>Data Join</h2>
<p>In order to join all the separate data sets, some of which were at the zip code level, we used an additional zip code-modzcta conversion file to convert them to such levels. Once all datasets had a modzcta variable, we joined them together.</p>
<pre class="r"><code>covid_test &lt;- read_csv(&quot;raw_data/tests-by-zcta.csv&quot;)
covid_deathrate &lt;- read_csv(&quot;raw_data/deathrate_byzcta_clean.csv&quot;)
school_data_clean &lt;- read_csv(&quot;raw_data/filtered_weighted_avgs.csv&quot;)

zip_mod &lt;- read_csv(&quot;raw_data/ZCTA-to-MODZCTA.csv&quot;) %&gt;% 
  rename(zip = ZCTA)

school &lt;- read_csv(&quot;raw_data/shsat_data.csv&quot;) 

covid_deathrate &lt;- read_csv(&quot;raw_data/deathrate_byzcta_clean.csv&quot;)

zcta_skool &lt;- full_join(zip_mod, school, by = &quot;zip&quot;) %&gt;% 
  rename(
     modzcta = MODZCTA
  ) %&gt;% 
  select(-`...1`)

zcta_skool_covidtest = full_join(zcta_skool, covid_test, by = &quot;modzcta&quot;) %&gt;% 
  janitor::clean_names()

project_df_deathrate = 
  full_join(zcta_skool_covidtest, covid_deathrate, by = &quot;modzcta&quot;) %&gt;% 
  janitor::clean_names()


# write_csv(zcta_skool_covidtest, &quot;project_df.csv&quot;)</code></pre>
<pre class="r"><code>school_covidtest &lt;- full_join(school_data_clean, covid_test, by = &quot;modzcta&quot;) %&gt;% 
  janitor::clean_names()

final_mod_zcta &lt;- full_join(school_covidtest, covid_deathrate, by = &quot;modzcta&quot;) %&gt;% 
  janitor::clean_names() %&gt;% 
  rename_with(~ gsub(&#39;x&#39;, &#39;&#39;, .x)) 


# write_csv(final_mod_zcta, &quot;final_mod_zcta.csv&quot;)</code></pre>
</div>
<div id="exploratory-data-analysis-eda" class="section level2">
<h2>Exploratory Data Analysis (EDA)</h2>
<div id="the-distribution-of-specialized-high-school-offers-in-new-york-city" class="section level4">
<h4>The Distribution of Specialized High School Offers in New York City</h4>
<p><em>Figure 1: Proportion of Offers by Number of Testers Across NYC Boroughs, 2015-2020</em></p>
<pre class="r"><code>shsat_covid_df = 
  read_csv(&quot;raw_data/project_df.csv&quot;) %&gt;%
  mutate(
    year = factor(year, levels = c(&quot;2015&quot;, &quot;2016&quot;, &quot;2017&quot;, &quot;2018&quot;, &quot;2019&quot;, &quot;2020&quot;))
  ) %&gt;% 
  select(zip, modzcta, borough, 
         dbn, year, n_hs_applicants, n_testers, n_offers, 
         modzcta_cum_perc_pos, cum_ave_death_rate
         )

shsat_covid_df %&gt;%
  filter(n_offers &gt; 5) %&gt;% 
  filter(year != 2015) %&gt;% 
  mutate(
    offers_per_applicants = n_offers / n_hs_applicants
  ) %&gt;% 
  group_by(year) %&gt;% 
  ggplot(aes(x = year, y = offers_per_applicants)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.1, color = &quot;red&quot;) +
  facet_grid(. ~borough) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = &quot;bottom&quot;) +
  labs(
    title = &quot;Borough and Year Differences in Number of Specialized High School Admissions Offers&quot;,
    subtitle = &quot;Offers per applicants is the fraction of students among those applying to specialized schools who receive offers&quot;,
    x = &quot;Year&quot;,
    y = &quot;Offers Per Applicants&quot;
  )</code></pre>
<p><img src="Final_Project_Report_files/figure-html/hs_admits_overview-1.png" width="90%" /></p>
<p><em>Figure 2: Number of Offers by Proportion of Students Additionally Applying to Specialized Schools</em></p>
<pre class="r"><code>shsat_covid_df %&gt;%
  filter(n_offers &gt; 5,
         year != 2015) %&gt;% 
  mutate(
    spec_per_applicants = n_testers / n_hs_applicants,
    offers_per_tester = n_offers / n_testers
  ) %&gt;% 
  group_by(year) %&gt;% 
  ggplot(aes(y = offers_per_tester, x = spec_per_applicants)) +
  geom_point() +
  geom_smooth(method = lm) +
  facet_grid(. ~borough) +
  labs(
    title = &quot;Do schools with more students applying to specialized schools get more offers?&quot;,
    x = &quot;Proportion of HS Applicants Applying to Specialized High Schools&quot;,
    y = &quot;Proportion of Offers to # Specailized HS Applicants&quot;
  ) +
  theme(axis.text.x = element_text(angle = 90))</code></pre>
<p><img src="Final_Project_Report_files/figure-html/teters_vs_allapps-1.png" width="90%" /></p>
<p>Note that data from 2015 are excluded from this figure as the number of students applying specifically to specialized high school applicants was the same as the number of students in general high school admissions, suggesting that the number of students in general admissions was not recorded for 2015.</p>
<p>Since applying to most high schools and to specialized high schools are two separate processes, we were interested in whether there is a relationship between how common it is to apply to specialized high schools at a given middle school, and how many specialized high school admissions offers that school receives. The X axis of Figure 2 describes: out of the students applying to high school, how many are also applying to specialized high schools? The Y axis then adds: how many students receive offers to specialized high schools for different prevalence of specialized high school applications?</p>
<p>In the Bronx and on Staten Island, there are few schools where a majority of the students applying to high school are additionally applying to specialized high schools, and of the students who do apply to specialized high schools, few receive an offer.</p>
<p>In Brooklyn, Manhattan, and Queens, the greatest proportion of admissions offers per specialized high school applicant are received at schools where most students apply to specialized high schools. In Brooklyn and Queens, there are some schools where most students apply to specialized high schools, but few get in. Overall, these data suggest that the middle school a student attends is strongly correlated with how likely that student is to be offered admission to a specialized high school.</p>
</div>
<div id="specialized-high-school-offers-and-covid-19" class="section level4">
<h4>Specialized High School Offers and Covid-19</h4>
<p><em>Figure 3: Number of Offers Before and During the Covid-19 Pandemic</em></p>
<pre class="r"><code># Re-define a df with weighed averages to include borough (which is excluded in the final_mod_zcta file)

zcta_wt_avgs_df =
  read_csv(&quot;raw_data/project_df.csv&quot;) %&gt;%
  select(modzcta, dbn, borough, n_hs_applicants, n_testers, n_offers, year, modzcta_cum_perc_pos, cum_ave_death_rate) %&gt;%
  filter(n_offers &gt; 5) %&gt;% 
  drop_na() %&gt;% 
  mutate(
    offers_per_testers = n_offers / n_testers,
    spec_per_applicants = n_testers / n_hs_applicants
  ) %&gt;% 
  group_by(modzcta, year, borough) %&gt;% 
  summarize(
    avg_testers = mean(n_testers),
    avg_offers = mean(n_offers),
    avg_applicants = mean(n_hs_applicants),
    wt_avg_offers = weighted.mean(n_offers, n_testers),
    avg_offer_per_tester = mean(offers_per_testers),
    avg_spec_per_applicants = mean(spec_per_applicants)
  )

# Plot the zipcode level weighted average number of offers by borough before and during the Covid-19 pandemic

precovid_boro_wt_avg =
  zcta_wt_avgs_df %&gt;% 
  select(modzcta, year, wt_avg_offers, borough) %&gt;%
  drop_na() %&gt;% 
  group_by(modzcta, year, borough) %&gt;%
  summarize(
    avg_wt_avg = mean(wt_avg_offers)
  ) %&gt;% 
  pivot_wider(names_from = year, values_from = avg_wt_avg) %&gt;%
  drop_na() %&gt;% 
  mutate(
    precovid_wt_avg = mean(`2015`:`2019`)
    ) %&gt;%
  ggplot(aes(x = borough, y = precovid_wt_avg)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.2, color = &quot;red&quot;) +
  ylim(-10, 225) +
  labs(
    y = &quot;Weighted Avg. # Offers&quot;, 
    x = &quot;Borough&quot;,
    title = &quot;Pre-Covid (2015-2019)&quot;
    ) +
   theme(plot.title = element_text(hjust = 0.5))


covid_boro_wt_avg =
  zcta_wt_avgs_df %&gt;% 
  filter(year == 2020) %&gt;% 
  group_by(borough) %&gt;% 
  ggplot(aes(x = borough, y = wt_avg_offers)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.2, color = &quot;red&quot;) +
  ylim(-10, 225) +
  labs(
    y = &quot;Weighted Avg. # Offers&quot;, 
    x = &quot;Borough&quot;, 
    title = &quot;Covid (2020)&quot;
    ) +
  theme(plot.title = element_text(hjust = 0.5))

patchwork = precovid_boro_wt_avg + covid_boro_wt_avg

patchwork + plot_annotation(
  title = &quot;Difference in Admissions Offers Before and During the Covid-19 Pandemic&quot;,
  subtitle = &quot;Number of offers received at a school is weighted by the number of SHSAT test takers at that school, then averaged across ZCTA&quot;,
  theme(text = element_text(hjust = 0.5))
)</code></pre>
<p><img src="Final_Project_Report_files/figure-html/wt_avg_covid_precovid-1.png" width="90%" /></p>
<p><em>Figure 4</em></p>
<pre class="r"><code># join in borough data that was excluded from the final analysis df
modzcta_to_borough = 
  shsat_covid_df %&gt;% 
  select(modzcta, borough) %&gt;% 
  unique()

final_shsat_modzcta =
  read_csv(&quot;raw_data/final_mod_zcta.csv&quot;) %&gt;% 
  select(modzcta,
         all_years_avg_testers, 
         all_years_avg_offers, 
         all_years_wt_avg, 
         `2015_19_avg_testers`, 
         `2015_19_avg_offers`, 
         `2015_19_wt_avg`, 
         avg_testers_2020, 
         avg_offers_2020, 
         wt_avg_2020,   
         modzcta_cum_perc_pos,
         cum_ave_death_rate) %&gt;% 
  drop_na() %&gt;% 
  full_join(modzcta_to_borough, .x, by = &quot;modzcta&quot;)
  
# plot weighted average n offers before and during Covid

wt_avg_vs_covidtest =
  final_shsat_modzcta %&gt;% 
  ggplot(aes(x = modzcta_cum_perc_pos, y = wt_avg_2020)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  labs(
   x = &quot;Cumulative Covid-19 % Positivity 
   Rate 3/20 - 12/20&quot;,
   y = &quot;Weighted Average # Offers Per ZCTA&quot;,
   title = &quot;Positivity Rate&quot;
  )

wt_avg_vs_death =
  final_shsat_modzcta %&gt;%
  ggplot(aes(x = cum_ave_death_rate, y = wt_avg_2020)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  labs(
    x = &quot;Cumulative Avg Covid-19 Death Rate 
    Per 100,000 3/20 - 12/20&quot;,
    y = &quot;Weighted Average # Offers Per ZCTA&quot;,
    title = &quot;Death Rate&quot;
  )

patchwork = wt_avg_vs_covidtest + wt_avg_vs_death

patchwork + plot_annotation(
  title = &quot;Relationship Bewteen Covid Positvity Rate, Death Rate and Number of Offers per ZCTA&quot;
)</code></pre>
<p><img src="Final_Project_Report_files/figure-html/covid_admit_rate_gg-1.png" width="90%" /></p>
</div>
</div>
<div id="primary-analysis" class="section level2">
<h2>Primary Analysis</h2>
<p>We used descriptive statistics to summarize the distribution of our dependent variable: the average number of SHSAT offers in 2020 by MOZCTA, and relevant predictors: the cumulative Covid-19 positive incidence rate and the cumulative death rate from March until December 2020.</p>
<p>We rann chi square tests to test if there was a significant difference between the number of offers in 2020 and the number of offers from 2015 until 2019. Additionally we tested if there was a significant difference between the number of testers in 2020 and the weighted average for the number of offers from 2015 until 2019.</p>
<pre class="r"><code>chisq_df =
  read_csv(&quot;raw_data/project_df.csv&quot;) %&gt;%
  filter(n_offers &gt; 5) %&gt;% 
  select(modzcta, dbn, n_testers, n_offers, year) %&gt;%
  drop_na() %&gt;% 
  group_by(dbn, year) %&gt;% 
  pivot_wider(names_from = year, values_from = n_testers:n_offers) %&gt;%
  drop_na() %&gt;% 
  summarize(
    `2015-19_avg_testers` = mean(n_testers_2015:n_testers_2019),
    `2020_testers` = n_testers_2020,
    `2015-19_avg_offers` = mean(n_offers_2015:n_offers_2019),
    `2020_offers` = n_offers_2020
  ) %&gt;% 
  mutate(
    `2015-19_prop` = `2015-19_avg_offers` / `2015-19_avg_testers`,
    `2020_prop` = `2020_offers` / `2020_testers`
  )

chi1 &lt;- chisq_df %&gt;% 
  select(`2015-19_avg_testers`, `2020_testers`) %&gt;% 
  chisq.test() 

chi1 %&gt;% 
  broom::tidy() %&gt;% 
  dplyr::select(p.value) %&gt;% 
  knitr::kable(digits = 5)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">9e-05</td>
</tr>
</tbody>
</table>
<pre class="r"><code>chi2 &lt;- chisq_df %&gt;% 
  select(`2015-19_avg_offers`, `2020_offers`) %&gt;% 
  chisq.test() 

chi2 %&gt;% 
  broom::tidy() %&gt;% 
  dplyr::select(p.value) %&gt;% 
  knitr::kable(digits = 5)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.1244</td>
</tr>
</tbody>
</table>
</div>
<div id="additional-analysis-modeling" class="section level2">
<h2>Additional Analysis: Modeling</h2>
<p>For our secondary analysis, we excluded all schools with less than 5 students receiving offers to specialized high schools to avoid positivity violations. Because our dependent variable is a count (number of offers), we used a poisson linear regression. However, because the distribution of the data was overspread, the variance did not equal the mean. To avoid the violation of this assumption, we used a Quasi-Poisson model, which assumes that the variance is a linear function of the mean. In our primary model, we calculated the change in the number of SHSAT offers by a 10% increase in the cumulative Covid-19 incidence. We progressively adjusted the model, including the total number of testers by MOZCTA. Additionally, we run a secondary model with 10% increase in the cumulative mortality rate as the main predictor.</p>
<pre class="r"><code>#this is the main model (10% change in cumulative incidence as predictor)

final_mod_zcta</code></pre>
<pre><code>## # A tibble: 178 × 25
##      `1` modzcta all_years_avg_testers all_years_avg_offers all_years_wt_avg
##    &lt;dbl&gt;   &lt;dbl&gt;                 &lt;dbl&gt;                &lt;dbl&gt;            &lt;dbl&gt;
##  1     1   10001                   5                    5               5   
##  2     2   10002                  36.9                 28.4            43.2 
##  3     3   10003                  42.8                 32.2            44.2 
##  4     4   10004                  62.5                 36              10   
##  5     5   10009                  19.5                 11.3             6.12
##  6     6   10010                  80.5                 50.5            40.5 
##  7     7   10011                  97.5                 75              99.2 
##  8     8   10021                 255                  152.             75.5 
##  9     9   10023                  11.3                 10               7   
## 10    10   10024                  53.8                 40              28.7 
## # … with 168 more rows, and 20 more variables: 2015_19_avg_testers &lt;dbl&gt;,
## #   2015_19_avg_offers &lt;dbl&gt;, 2015_19_wt_avg &lt;dbl&gt;, avg_testers_2020 &lt;dbl&gt;,
## #   avg_offers_2020 &lt;dbl&gt;, wt_avg_2020 &lt;dbl&gt;, positive &lt;dbl&gt;, total &lt;dbl&gt;,
## #   modzcta_cum_perc_pos &lt;dbl&gt;, 3_2020 &lt;dbl&gt;, 4_2020 &lt;dbl&gt;, 5_2020 &lt;dbl&gt;,
## #   6_2020 &lt;dbl&gt;, 7_2020 &lt;dbl&gt;, 8_2020 &lt;dbl&gt;, 9_2020 &lt;dbl&gt;, 10_2020 &lt;dbl&gt;,
## #   11_2020 &lt;dbl&gt;, 12_2020 &lt;dbl&gt;, cum_ave_death_rate &lt;dbl&gt;</code></pre>
<pre class="r"><code>model1 = glm(avg_offers_2020 ~ cum_perc , family = quasipoisson, data = data)</code></pre>
<pre><code>## Error in model.frame.default(formula = avg_offers_2020 ~ cum_perc, data = data, : &#39;data&#39; must be a data.frame, environment, or list</code></pre>
<pre class="r"><code>model1 %&gt;% 
  broom::tidy() %&gt;% 
  dplyr::select(term, estimate, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;cum_perc&quot;, &quot;Cumulative incidence &quot;)) %&gt;% 
  knitr::kable(digits = 3)</code></pre>
<pre><code>## Error in broom::tidy(.): object &#39;model1&#39; not found</code></pre>
<pre class="r"><code>#model adjusted by number of testers
model3 = glm(avg_offers_2020 ~ cum_perc + avg_testers_2020, family = quasipoisson, data = data)</code></pre>
<pre><code>## Error in model.frame.default(formula = avg_offers_2020 ~ cum_perc + avg_testers_2020, : &#39;data&#39; must be a data.frame, environment, or list</code></pre>
<pre class="r"><code>model3 %&gt;% 
  broom::tidy() %&gt;% 
  dplyr::select(term, estimate, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;cum_perc&quot;, &quot;Cumulative incidence &quot;)) %&gt;% 
  knitr::kable(digits = 3)</code></pre>
<pre><code>## Error in broom::tidy(.): object &#39;model3&#39; not found</code></pre>
<pre class="r"><code>#model adjusted by number of testers and death rate
model4 = glm(avg_offers_2020 ~ cum_perc + avg_testers_2020 + cum_death, family = quasipoisson, data = data)</code></pre>
<pre><code>## Error in model.frame.default(formula = avg_offers_2020 ~ cum_perc + avg_testers_2020 + : &#39;data&#39; must be a data.frame, environment, or list</code></pre>
<pre class="r"><code>model4 %&gt;% 
  broom::tidy() %&gt;% 
  dplyr::select(term, estimate, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;cum_perc&quot;, &quot;Cumulative incidence &quot;)) %&gt;% 
  knitr::kable(digits = 3)</code></pre>
<pre><code>## Error in broom::tidy(.): object &#39;model4&#39; not found</code></pre>
<pre class="r"><code>#model with a 10% change in death rate as the main predictor
model2 = glm(wt_avg_2020 ~ cum_death, family = quasipoisson, data = data)</code></pre>
<pre><code>## Error in model.frame.default(formula = wt_avg_2020 ~ cum_death, data = data, : &#39;data&#39; must be a data.frame, environment, or list</code></pre>
<pre class="r"><code>model2 %&gt;% 
  broom::tidy() %&gt;% 
  dplyr::select(term, estimate, p.value) %&gt;% 
  mutate(term = str_replace(term, &quot;cum_death&quot;, &quot;Cumulative death rate&quot;)) %&gt;% 
  knitr::kable(digits = 5)</code></pre>
<pre><code>## Error in broom::tidy(.): object &#39;model2&#39; not found</code></pre>
</div>
<div id="discussion" class="section level2">
<h2>Discussion</h2>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
