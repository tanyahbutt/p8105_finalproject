---
title: "models_finalproject"
author: 'IRENE MARTINEZ MORATA (UNI: im2557)'
date: "12/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(broom)
library(modelr)
```
##load datasets

```{r}
data <- read_csv("final_mod_zcta.csv") %>% 
  mutate(all_years_avg_offers = round(all_years_avg_offers, digits = 0), 
         all_years_wt_avg_offers = round(all_years_avg_offers, digits = 0),
         wt_avg_2020 = round(wt_avg_2020, digits = 0)) %>% 
  mutate(cum_perc = 10*(modzcta_cum_perc_pos),
         cum_death = 10*(cum_ave_death_rate))
```

##Chi squares

```{r}
#chi sq between the proportion of offers in 2019 vs 2020



```



## Quasi poisson regression

```{r }

#this is the main model (10% change in cumulative incidence as predictor)
model1 <- glm(avg_offers_2020 ~ cum_perc , family = quasipoisson, data = data)
model1 %>% 
broom::tidy() %>% 
dplyr::select(term, estimate, p.value) %>% 
  mutate(term = str_replace(term, "cum_perc", "Cumulative incidence ")) %>% 
  knitr::kable(digits = 3)

#model adjusted by number of testers
model3 <- glm(avg_offers_2020 ~ cum_perc + avg_testers_2020, family = quasipoisson, data = data)
model3 %>% 
broom::tidy() %>% 
dplyr::select(term, estimate, p.value) %>% 
  mutate(term = str_replace(term, "cum_perc", "Cumulative incidence ")) %>% 
  knitr::kable(digits = 3)


#model adjusted by number of testers and death rate
model4 <- glm(avg_offers_2020 ~ cum_perc + avg_testers_2020 + cum_death, family = quasipoisson, data = data)
model4 %>% 
broom::tidy() %>% 
dplyr::select(term, estimate, p.value) %>% 
  mutate(term = str_replace(term, "cum_perc", "Cumulative incidence ")) %>% 
  knitr::kable(digits = 3)



#model with a 10% change in death rate as the main predictor

model2 <- glm(wt_avg_2020 ~ cum_death, family = quasipoisson, data = data)
model2 %>% 
broom::tidy() %>% 
dplyr::select(term, estimate, p.value) %>% 
  mutate(term = str_replace(term, "cum_death", "Cumulative death rate")) %>% 
  knitr::kable(digits = 5)

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
